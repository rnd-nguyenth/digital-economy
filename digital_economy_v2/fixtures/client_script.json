[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Digital Economy Index",
  "enabled": 1,
  "modified": "2024-12-27 14:59:04.460161",
  "module": "Digital Economy V2",
  "name": "Cập nhật trường thoi_gian (Digital Economy Index)",
  "script": "frappe.ui.form.on('Digital Economy Index', {\r\n    quy: function(frm) {\r\n        update_time(frm);\r\n    },\r\n    nam: function(frm) {\r\n        update_time(frm);\r\n    },\r\n});\r\n\r\nfunction update_time(frm) {\r\n    let thang_map = { \"Q1\": \"01\", \"Q2\": \"04\", \"Q3\": \"07\", \"Q4\": \"10\" };\r\n    let thang = thang_map[frm.doc.quy] || \"01\";\r\n    let thoi_gian_moi = `${frm.doc.nam}-${thang}-01`;\r\n    if (frm.doc.thoi_gian !== thoi_gian_moi) {\r\n        frm.set_value(\"thoi_gian\", thoi_gian_moi);\r\n    }\r\n}\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Digital Economy Index",
  "enabled": 1,
  "modified": "2024-12-27 14:59:04.516030",
  "module": "Digital Economy V2",
  "name": "Tự động truyền dữ liệu vào bảng con và tính tổng điểm cơ sở",
  "script": "frappe.ui.form.on('Digital Economy Index', {\r\n    onload: function(frm) {\r\n        if (frm.is_new()) {\r\n            frm.clear_table(\"bang_nen_tang\");\r\n            frm.clear_table(\"bang_nen_tang_thanh_phan\");\r\n            frm.clear_table(\"bang_ict\");\r\n            frm.clear_table(\"bang_ict_thanh_phan\");\r\n            frm.clear_table(\"bang_logistics\");\r\n            frm.clear_table(\"bang_logistics_thanh_phan\");\r\n\r\n            const ChiSoNenTang = [\r\n                \"Tỷ trọng lao động KTS trên tổng lao động\",\r\n                \"Băng thông kết nối Internet trong nước\",\r\n                \"Số thuê bao ĐTDĐ trên 100 dân\",\r\n                \"Thuê bao Internet băng rộng cố định trên 100 dân\",\r\n                \"Thuê bao Internet băng rộng di động trên 100 dân\",\r\n                \"Thuê bao truy cập Internet băng rộng trên 100 dân\"\r\n            ];\r\n            \r\n            const ChiSoNenTangThanhPhan = [\r\n                \"Số lao động ICT\",\r\n                \"Tổng số lao động\",\r\n                \"Số thuê bao điện thoại di động\",\r\n                \"Dân số Hải Phòng\",\r\n                \"Thuê bao Internet băng rộng cố định\",\r\n                \"Thuê bao Internet băng rộng di động\",\r\n                \"Thuê bao truy cập Internet băng rộng\"\r\n            ];\r\n            \r\n            const ChiSoICT = [\r\n                \"Tỷ trọng tên miền .vn trên địa bàn\",\r\n                \"Tỷ trọng số DN ICT trên tổng số DN\",\r\n                \"Tỷ trọng doanh thu DN ICT trên tổng doanh thu\",\r\n                \"Tỷ trọng KTS trong GRDP\",\r\n                \"Tỷ trọng KTS ngành, lĩnh vực ngoài ICT trong GRDP\",\r\n                \"Tỷ trọng doanh thu TMĐT trên tổng DT của doanh nghiệp\",\r\n                \"Tỷ trọng doanh thu TMĐT theo kho hàng địa phương trên tổng doanh thu\",\r\n                \"Tỷ trọng DN có phát sinh doanh thu trên sàn TMĐT trên tổng DN trên địa bàn\",\r\n                \"Tỷ trọng DN có hoạt động đổi mới công nghệ\",\r\n                \"Tăng trưởng NSLĐ\",\r\n                \"Tỷ trọng xuất khẩu phần cứng trên tổng kim ngạch nhập khẩu\"\r\n            ];\r\n            \r\n            const ChiSoICTThanhPhan = [\r\n                \"Tên miền .vn\",\r\n                \"Tổng doanh nghiệp ICT\",\r\n                \"Tổng doanh nghiệp\",\r\n                \"Doanh thu ICT\",\r\n                \"Tổng doanh thu\",\r\n                \"Doanh thu TMĐT\",\r\n                \"Doanh số theo kho hàng\",\r\n                \"Doanh nghiệp phát sinh doanh thu trên TMĐT\",\r\n                \"Doanh nghiệp hoạt động đổi mới công nghệ\",\r\n                \"NSLĐ năm trước (triệu/người)\",\r\n                \"NSLĐ năm nay (triệu/người)\",\r\n                \"Giá trị xuất khẩu phần cứng\",\r\n                \"Kim ngạch xuất khẩu phần cứng\"\r\n            ];\r\n            \r\n            const ChiSoLogistics = [\r\n                \"Tỷ trọng DN Logistics có hoạt động đổi mới công nghệ\",\r\n                \"Tỷ trọng DN Logistics trên địa bàn\",\r\n                \"Tỷ trọng KTS ngành Logistics trong VA ngành Logistics\",\r\n                \"Tỷ trọng doanh thu thuần bán hàng và cung cấp DV qua hình thức trực tuyến của các DN logistic\",\r\n                \"Tỷ trọng doanh thu DN Logistics trên tổng doanh thu\",\r\n                \"Tăng trưởng NSLĐ ngành Logistics\"\r\n            ];\r\n            \r\n            const ChiSoLogisticsThanhPhan = [\r\n                \"Doanh nghiệp Logistic có HĐ đổi mới công nghệ\",\r\n                \"Tổng doanh nghiệp Logistics\",\r\n                \"Tổng doanh nghiệp\",\r\n                \"Doanh thu qua TMĐT của doanh nghiệp Logistics\",\r\n                \"Tổng doanh thu Logistics\",\r\n                \"Tổng doanh thu\",\r\n                \"NSLĐ năm trước (triệu/người)\",\r\n                \"NSLĐ năm nay (triệu/người)\"\r\n            ];    \r\n            \r\n            // Function to add unique rows to child tables\r\n            function addUniqueRows(list, tableName) {\r\n                list.forEach(item => {\r\n                    if (!frm.doc[tableName].some(row => row.ten_chi_so === item)) {\r\n                        frm.add_child(tableName, { ten_chi_so: item });\r\n                    }\r\n                });\r\n            }\r\n\r\n            // Add predefined rows to all tables\r\n            addUniqueRows(ChiSoNenTang, \"bang_nen_tang\");\r\n            addUniqueRows(ChiSoNenTangThanhPhan, \"bang_nen_tang_thanh_phan\");\r\n            addUniqueRows(ChiSoICT, \"bang_ict\");\r\n            addUniqueRows(ChiSoICTThanhPhan, \"bang_ict_thanh_phan\");\r\n            addUniqueRows(ChiSoLogistics, \"bang_logistics\");\r\n            addUniqueRows(ChiSoLogisticsThanhPhan, \"bang_logistics_thanh_phan\");\r\n\r\n            // Refresh fields to reflect changes\r\n            frm.refresh_field(\"bang_nen_tang\");\r\n            frm.refresh_field(\"bang_nen_tang_thanh_phan\");\r\n            frm.refresh_field(\"bang_ict\");\r\n            frm.refresh_field(\"bang_ict_thanh_phan\");\r\n            frm.refresh_field(\"bang_logistics\");\r\n            frm.refresh_field(\"bang_logistics_thanh_phan\");\r\n\r\n            // Fetch diem_co_so for each row in bang_ict\r\n            fetchDiemCoSo(frm, 'bang_ict');\r\n            fetchDiemCoSo(frm, 'bang_nen_tang');\r\n            fetchDiemCoSo(frm, 'bang_logistics');\r\n        }\r\n    },\r\n\r\n    validate: function(frm) {\r\n        // Sum the diem_co_so values from bang_ict\r\n        let tong_diem_co_so_ict = frm.doc.bang_ict.reduce((sum, row) => {\r\n            return sum + (row.diem_co_so || 0);\r\n        }, 0);\r\n\r\n        // Set the tong_diem_co_so_ict field to the calculated value\r\n        frm.set_value('tong_diem_co_so_ict', tong_diem_co_so_ict);\r\n\r\n        // Sum for bang_nen_tang\r\n        let tong_diem_co_so_nen_tang = frm.doc.bang_nen_tang.reduce((sum, row) => {\r\n            return sum + (row.diem_co_so || 0);\r\n        }, 0);\r\n\r\n        frm.set_value('tong_diem_co_so_nen_tang', tong_diem_co_so_nen_tang);\r\n\r\n        // Sum for bang_logistics\r\n        let tong_diem_co_so_logistics = frm.doc.bang_logistics.reduce((sum, row) => {\r\n            return sum + (row.diem_co_so || 0);\r\n        }, 0);\r\n\r\n        frm.set_value('tong_diem_co_so_logistics', tong_diem_co_so_logistics);\r\n    }\r\n});\r\n\r\n// Function to fetch diem_co_so for a given table\r\nfunction fetchDiemCoSo(frm, tableName) {\r\n    frm.doc[tableName].forEach(row => {\r\n        frappe.call({\r\n            method: \"frappe.client.get\",\r\n            args: {\r\n                doctype: \"Index Name\",\r\n                filters: { ten_chi_so: row.ten_chi_so }\r\n            },\r\n            callback: function (response) {\r\n                if (response.message) {\r\n                    let diem_co_so = response.message.diem_co_so;\r\n                    row.diem_co_so = diem_co_so;\r\n                }\r\n                frm.refresh_field(tableName);\r\n            }\r\n        });\r\n    });\r\n}\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Digital Economy Index",
  "enabled": 1,
  "modified": "2024-12-27 14:59:04.558245",
  "module": "Digital Economy V2",
  "name": "Tính toán Bảng chỉ số dựa trên Bảng thành phần",
  "script": "frappe.ui.form.on(\"Foundation Sub-Index\", {\r\n    gia_tri: function(frm, cdt, cdn) {\r\n        var row = locals[cdt][cdn]; \r\n        if (row.gia_tri) { \r\n            calculate_dat_duoc(frm, \"bang_nen_tang_thanh_phan\", \"bang_nen_tang\", foundationMappings);\r\n            }\r\n        }\r\n    });\r\n\r\nfrappe.ui.form.on(\"ICT Sub-Index\", {\r\n    gia_tri: function(frm, cdt, cdn) {\r\n        var row = locals[cdt][cdn]; \r\n        if (row.gia_tri) { \r\n            calculate_dat_duoc(frm, \"bang_ict_thanh_phan\", \"bang_ict\", ictMappings);\r\n            }\r\n        }\r\n    });\r\n\r\nfrappe.ui.form.on(\"Logistics Sub-Index\", {\r\n    gia_tri: function(frm, cdt, cdn) {\r\n        var row = locals[cdt][cdn]; \r\n        if (row.gia_tri) { \r\n            calculate_dat_duoc(frm, \"bang_logistics_thanh_phan\", \"bang_logistics\", logisticsMappings);\r\n            }\r\n        }\r\n    });\r\n    \r\n// Mappings cho Foundation Sub-Index và ICT Sub-Index\r\nconst foundationMappings = {\r\n    \"Số lao động ICT\": \"soLaoDongICT\",\r\n    \"Tổng số lao động\": \"tongSoLaoDong\",\r\n    \"Số thuê bao điện thoại di động\": \"soThueBaoDiDong\",\r\n    \"Dân số Hải Phòng\": \"danSoHaiPhong\",\r\n    \"Thuê bao Internet băng rộng cố định\": \"thueBaoInternetBangRongCoDinh\",\r\n    \"Thuê bao Internet băng rộng di động\": \"thueBaoInternetBangRongDiDong\",\r\n    \"Thuê bao truy cập Internet băng rộng\": \"thueBaoTruyCapInternetBangRong\"\r\n};\r\n\r\nconst ictMappings = {\r\n    \"Tên miền .vn\": \"tenMienChamVn\",\r\n    \"Tổng doanh nghiệp ICT\": \"tongDoanhNghiepIct\",\r\n    \"Tổng doanh nghiệp\": \"tongDoanhNghiep\",\r\n    \"Doanh thu ICT\": \"doanhThuIct\",\r\n    \"Tổng doanh thu\": \"tongDoanhThu\",\r\n    \"Doanh thu TMĐT\": \"doanhThuTmdt\",\r\n    \"Doanh số theo kho hàng\": \"doanhSoTheoKhoHang\",\r\n    \"Doanh nghiệp phát sinh doanh thu trên TMĐT\": \"doanhNghiepPhatSinhDoanhThuTrenTmdt\",\r\n    \"Doanh nghiệp hoạt động đổi mới công nghệ\": \"doanhNghiepHoatDongDoiMoiCongNghe\",\r\n    \"NSLĐ năm trước (triệu/người)\": \"nsldNamTruoc\",\r\n    \"NSLĐ năm nay (triệu/người)\": \"nsldNamNay\",\r\n    \"Giá trị xuất khẩu phần cứng\": \"giaTriXuatKhauPhanCung\",\r\n    \"Kim ngạch xuất khẩu phần cứng\": \"kimNgachXuatKhauPhanCung\"\r\n};\r\n\r\nconst logisticsMappings = {\r\n    \"Doanh nghiệp Logistic có HĐ đổi mới công nghệ\": \"doanhNghiepLogisticsCoHdDoiMoiCongNghe\",\r\n    \"Tổng doanh nghiệp Logistics\": \"tongDoanhNghiepLogistics\",\r\n    \"Tổng doanh nghiệp\": \"tongDoanhNghiep\",\r\n    \"Doanh thu qua TMĐT của doanh nghiệp Logistics\": \"doanhThuQuaTmdtCuaDoanhNghiepLogistics\",\r\n    \"Tổng doanh thu Logistics\": \"tongDoanhThuLogistics\",\r\n    \"Tổng doanh thu\": \"tongDoanhThu\",\r\n    \"NSLĐ năm trước (triệu/người)\": \"nsldNamTruoc\",\r\n    \"NSLĐ năm nay (triệu/người)\": \"nsldNamNay\",\r\n};\r\n\r\nfunction calculate_dat_duoc(frm, sourceTable, targetTable, mappings) {\r\n    // Tạo đối tượng để lưu trữ các giá trị\r\n    let values = {};\r\n\r\n    // Lấy giá trị từ bảng thành phần\r\n    frm.doc[sourceTable].forEach(row => {\r\n        if (mappings[row.ten_chi_so] && row.gia_tri !== 0) {\r\n            values[mappings[row.ten_chi_so]] = row.gia_tri;\r\n        }\r\n    });\r\n\r\n    // Tính toán \"Đạt được\" cho các chỉ số\r\n    frm.doc[targetTable].forEach(row => {\r\n        switch (row.ten_chi_so) {\r\n            case \"Tỷ trọng lao động KTS trên tổng lao động\":\r\n                row.dat_duoc = values.tongSoLaoDong ? (values.soLaoDongICT / values.tongSoLaoDong) * 100 : 0;\r\n                break;\r\n            case \"Băng thông kết nối Internet trong nước\":\r\n                row.dat_duoc = values.thueBaoInternetBangRongDiDong ? (values.thueBaoInternetBangRongCoDinh / values.thueBaoInternetBangRongDiDong) * 100 : 0;\r\n                break;    \r\n            case \"Số thuê bao ĐTDĐ trên 100 dân\":\r\n                row.dat_duoc = values.danSoHaiPhong ? (values.soThueBaoDiDong / values.danSoHaiPhong) * 100 : 0;\r\n                break;\r\n            case \"Thuê bao Internet băng rộng cố định trên 100 dân\":\r\n                row.dat_duoc = values.danSoHaiPhong ? (values.thueBaoInternetBangRongCoDinh / values.danSoHaiPhong) * 100 : 0;\r\n                break;\r\n            case \"Thuê bao Internet băng rộng di động trên 100 dân\":\r\n                row.dat_duoc = values.danSoHaiPhong ? (values.thueBaoInternetBangRongDiDong / values.danSoHaiPhong) * 100 : 0;\r\n                break;\r\n            case \"Thuê bao truy cập Internet băng rộng trên 100 dân\":\r\n                row.dat_duoc = values.danSoHaiPhong ? (values.thueBaoTruyCapInternetBangRong / values.danSoHaiPhong) * 100 : 0;\r\n                break;\r\n            case \"Tỷ trọng tên miền .vn trên địa bàn\":\r\n                row.dat_duoc = values.tongDoanhNghiep ? (values.tenMienChamVn / values.tongDoanhNghiep) * 100 : 0;\r\n                break;\r\n            case \"Tỷ trọng số DN ICT trên tổng số DN\":\r\n                row.dat_duoc = values.tongDoanhNghiep ? (values.tongDoanhNghiepIct / values.tongDoanhNghiep) * 100 : 0;\r\n                break;\r\n            case \"Tỷ trọng doanh thu DN ICT trên tổng doanh thu\":\r\n                row.dat_duoc = values.tongDoanhThu ? (values.doanhThuIct / values.tongDoanhThu) * 100 : 0;\r\n                break;\r\n            case \"Tỷ trọng doanh thu TMĐT trên tổng DT của doanh nghiệp\":\r\n                row.dat_duoc = values.tongDoanhThu ? (values.doanhThuTmdt / values.tongDoanhThu) * 100 : 0;\r\n                break;\r\n            case \"Tỷ trọng doanh thu TMĐT theo kho hàng địa phương trên tổng doanh thu\":\r\n                row.dat_duoc = values.tongDoanhThu ? (values.doanhSoTheoKhoHang / values.tongDoanhThu) * 100 : 0;\r\n                break;\r\n            case \"Tỷ trọng DN có phát sinh doanh thu trên sàn TMĐT trên tổng DN trên địa bàn\":\r\n                row.dat_duoc = values.tongDoanhNghiep ? (values.doanhNghiepPhatSinhDoanhThuTrenTmdt / values.tongDoanhNghiep) * 100 : 0;\r\n                break;\r\n            case \"Tỷ trọng DN có hoạt động đổi mới công nghệ\":\r\n                row.dat_duoc = values.tongDoanhNghiep ? (values.doanhNghiepHoatDongDoiMoiCongNghe / values.tongDoanhNghiep) * 100 : 0;\r\n                break;\r\n            case \"Tăng trưởng NSLĐ\":\r\n                //row.dat_duoc = values.nsldNamNay ? (values.nsldNamTruoc / values.nsldNamNay) * 100 : 0;\r\n                row.dat_duoc = values.nsldNamTruoc ? (values.nsldNamNay / values.nsldNamTruoc) * 100 : 0;\r\n                break;\r\n            case \"Tỷ trọng xuất khẩu phần cứng trên tổng kim ngạch nhập khẩu\":\r\n                row.dat_duoc = values.kimNgachXuatKhauPhanCung ? (values.giaTriXuatKhauPhanCung / values.kimNgachXuatKhauPhanCung) * 100 : 0;\r\n                break;\r\n            case \"Tỷ trọng DN Logistics có hoạt động đổi mới công nghệ\":\r\n                row.dat_duoc = values.tongDoanhNghiepLogistics ? (values.doanhNghiepLogisticsCoHdDoiMoiCongNghe / values.tongDoanhNghiepLogistics) * 100 : 0;\r\n                break;\r\n            case \"Tỷ trọng DN Logistics trên địa bàn\":\r\n                row.dat_duoc = values.tongDoanhNghiep ? (values.tongDoanhNghiepLogistics / values.tongDoanhNghiep) * 100 : 0;\r\n                break;\r\n            case \"Tỷ trọng doanh thu thuần bán hàng và cung cấp DV qua hình thức trực tuyến của các DN logistic\":\r\n                row.dat_duoc = values.tongDoanhThuLogistics ? (values.doanhThuQuaTmdtCuaDoanhNghiepLogistics / values.tongDoanhThuLogistics) * 100 : 0;\r\n                break;\r\n            case \"Tỷ trọng doanh thu DN Logistics trên tổng doanh thu\":\r\n                row.dat_duoc = values.tongDoanhThu ? (values.tongDoanhThuLogistics / values.tongDoanhThu) * 100 : 0;\r\n                break;\r\n            case \"Tăng trưởng NSLĐ ngành Logistics\":\r\n                //row.dat_duoc = values.nsldNamNay ? (values.nsldNamTruoc / values.nsldNamNay) * 100 : 0;\r\n                row.dat_duoc = values.nsldNamTruoc ? (values.nsldNamNay / values.nsldNamTruoc) * 100 : 0;\r\n                break;\r\n        }\r\n    });\r\n\r\n    // Chỉ refresh bảng sau khi tất cả tính toán hoàn tất\r\n    frm.refresh_field(targetTable); \r\n}",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Digital Economy Index",
  "enabled": 1,
  "modified": "2024-12-27 14:59:04.537476",
  "module": "Digital Economy V2",
  "name": "Tính toán Điểm thực hiện ở Bảng chỉ số",
  "script": "frappe.ui.form.on(\"Foundation Index\", {\r\n    dat_duoc: function(frm, cdt, cdn) {\r\n        calculate_diem_quy_doi(frm, cdt, cdn);\r\n        calculate_tong_diem(frm);\r\n    },\r\n    muc_tieu: function(frm, cdt, cdn) {\r\n        calculate_diem_quy_doi(frm, cdt, cdn);\r\n        calculate_tong_diem(frm);\r\n    },\r\n    diem_co_so: function(frm, cdt, cdn) {\r\n        calculate_diem_quy_doi(frm, cdt, cdn);\r\n        calculate_tong_diem(frm);\r\n        calculate_tong_diem_co_so(frm);\r\n    }\r\n});\r\n\r\nfrappe.ui.form.on(\"ICT Index\", {\r\n    dat_duoc: function(frm, cdt, cdn) {\r\n        calculate_diem_quy_doi(frm, cdt, cdn);\r\n        calculate_tong_diem(frm);\r\n    },\r\n    muc_tieu: function(frm, cdt, cdn) {\r\n        calculate_diem_quy_doi(frm, cdt, cdn);\r\n        calculate_tong_diem(frm);\r\n    },\r\n    diem_co_so: function(frm, cdt, cdn) {\r\n        calculate_diem_quy_doi(frm, cdt, cdn);\r\n        calculate_tong_diem(frm);\r\n        calculate_tong_diem_co_so(frm);\r\n    }\r\n});\r\n\r\nfrappe.ui.form.on(\"Logistics Index\", {\r\n    dat_duoc: function(frm, cdt, cdn) {\r\n        calculate_diem_quy_doi(frm, cdt, cdn);\r\n        calculate_tong_diem(frm);\r\n    },\r\n    muc_tieu: function(frm, cdt, cdn) {\r\n        calculate_diem_quy_doi(frm, cdt, cdn);\r\n        calculate_tong_diem(frm);\r\n    },\r\n    diem_co_so: function(frm, cdt, cdn) {\r\n        calculate_diem_quy_doi(frm, cdt, cdn);\r\n        calculate_tong_diem(frm);\r\n        calculate_tong_diem_co_so(frm);\r\n    }\r\n});\r\n\r\nfunction calculate_diem_quy_doi(frm, cdt, cdn) {\r\n    let row = locals[cdt][cdn];\r\n    let muc_tieu = row.muc_tieu;\r\n    let diem_co_so = row.diem_co_so;\r\n    let dat_duoc = row.dat_duoc;\r\n    \r\n    if (row.dat_duoc != null && row.muc_tieu != null && row.diem_co_so != null) {\r\n        let muc_tieu = flt(row.muc_tieu) / 100;\r\n        let dat_duoc = flt(row.dat_duoc) / 100;\r\n        let diem_co_so = flt(row.diem_co_so);\r\n\r\n        row.diem_quy_doi = (dat_duoc >= muc_tieu) ? diem_co_so : (dat_duoc / muc_tieu) * diem_co_so;\r\n    } else {\r\n        row.diem_quy_doi = 0;\r\n    }\r\n\r\n    // Cập nhật giá trị trên giao diện\r\n    frm.refresh_field(\"bang_nen_tang\");\r\n    frm.refresh_field(\"bang_ict\"); \r\n    frm.refresh_field(\"bang_logistics\"); \r\n}\r\n\r\nfunction calculate_tong_diem(frm) {\r\n    let tong_diem_nen_tang = 0;\r\n    let tong_diem_ict = 0;\r\n    let tong_diem_logistics = 0;\r\n\r\n    // Tính tổng từ bảng bang_nen_tang\r\n    frm.doc.bang_nen_tang.forEach(row => {\r\n        if (row.diem_quy_doi) {\r\n            tong_diem_nen_tang += row.diem_quy_doi;\r\n        }\r\n    });\r\n\r\n    // Tính tổng từ bảng bang_ict\r\n    frm.doc.bang_ict.forEach(row => {\r\n        if (row.diem_quy_doi) {\r\n            tong_diem_ict += row.diem_quy_doi;\r\n        }\r\n    });\r\n\r\n    // Tính tổng từ bảng bang_logistics\r\n    frm.doc.bang_logistics. forEach(row => {\r\n        if (row.diem_quy_doi) {\r\n            tong_diem_logistics += row.diem_quy_doi;\r\n        }\r\n    });\r\n\r\n    // Cập nhật giá trị tổng điểm vào form\r\n    frm.set_value(\"tong_diem_nen_tang\", tong_diem_nen_tang);\r\n    frm.set_value(\"tong_diem_ict\", tong_diem_ict);\r\n    frm.set_value(\"tong_diem_logistics\", tong_diem_logistics);\r\n}\r\n\r\nfunction calculate_tong_diem_co_so(frm) {\r\n    let tong_diem_co_so_nen_tang = 0;\r\n    let tong_diem_co_so_ict = 0;\r\n    let tong_diem_co_so_logistics = 0;\r\n\r\n    // Tính tổng từ bảng bang_nen_tang\r\n    frm.doc.bang_nen_tang.forEach(row => {\r\n        if (row.diem_co_so) {\r\n            tong_diem_co_so_nen_tang += row.diem_co_so;\r\n        }\r\n    });\r\n\r\n    frm.doc.bang_ict.forEach(row => {\r\n        if (row.diem_co_so) {\r\n            tong_diem_co_so_ict += row.diem_co_so;\r\n        }\r\n    });\r\n\r\n    frm.doc.bang_logistics.forEach(row => {\r\n        if (row.diem_co_so) {\r\n            tong_diem_co_so_logistics += row.diem_co_so;\r\n        }\r\n    });\r\n\r\n    // Cập nhật giá trị tổng điểm cơ sở vào form\r\n    frm.set_value(\"tong_diem_co_so_nen_tang\", tong_diem_co_so_nen_tang);\r\n    frm.set_value(\"tong_diem_co_so_ict\", tong_diem_co_so_ict);\r\n    frm.set_value(\"tong_diem_co_so_logistics\", tong_diem_co_so_logistics);\r\n}\r\n\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Digital Economy Index",
  "enabled": 1,
  "modified": "2024-12-27 14:59:04.493819",
  "module": "Digital Economy V2",
  "name": "Ẩn nút thêm/xoá các bảng con",
  "script": "frappe.ui.form.on('Digital Economy Index', {\r\n    refresh: function(frm) {\r\n        frm.add_custom_button(__('Dashboard'), function() {\r\n            window.location.href = '/insights/dashboard';\r\n        });\r\n        if (frappe.session.user !== \"Administrator\") {\r\n            // Disable drag-and-drop and hide buttons for all specified child tables\r\n            disable_drag_drop_and_hide_buttons(frm);\r\n        }\r\n    },\r\n    bang_nen_tang_on_form_rendered: function(frm, cdt, cdn) {\r\n        if (frappe.session.user !== \"Administrator\") {\r\n            hide_child_table_buttons(frm, 'bang_nen_tang');\r\n        }\r\n    },\r\n    bang_nen_tang_thanh_phan_on_form_rendered: function(frm, cdt, cdn) {\r\n        if (frappe.session.user !== \"Administrator\") {\r\n            hide_child_table_buttons(frm, 'bang_nen_tang_thanh_phan');\r\n        }\r\n    },\r\n    bang_ict_on_form_rendered: function(frm, cdt, cdn) {\r\n        if (frappe.session.user !== \"Administrator\") {\r\n            hide_child_table_buttons(frm, 'bang_ict');\r\n        }\r\n    },\r\n    bang_ict_thanh_phan_on_form_rendered: function(frm, cdt, cdn) {\r\n        if (frappe.session.user !== \"Administrator\") {\r\n            hide_child_table_buttons(frm, 'bang_ict_thanh_phan');\r\n        }\r\n    },\r\n    bang_logistics_on_form_rendered: function(frm, cdt, cdn) {\r\n        if (frappe.session.user !== \"Administrator\") {\r\n            hide_child_table_buttons(frm, 'bang_logistics');\r\n        }\r\n    },\r\n    bang_logistics_thanh_phan_on_form_rendered: function(frm, cdt, cdn) {\r\n        if (frappe.session.user !== \"Administrator\") {\r\n            hide_child_table_buttons(frm, 'bang_logistics_thanh_phan');\r\n        }\r\n    }\r\n});\r\n\r\n// Disable drag and drop and hide buttons for multiple child tables\r\nfunction disable_drag_drop_and_hide_buttons(frm) {\r\n    const childTables = [\r\n        'bang_nen_tang',\r\n        'bang_nen_tang_thanh_phan',\r\n        'bang_ict',\r\n        'bang_ict_thanh_phan',\r\n        'bang_logistics',\r\n        'bang_logistics_thanh_phan'\r\n    ];\r\n\r\n    childTables.forEach(function(table) {\r\n        // Disable drag-and-drop for rows\r\n        frm.page.body.find(`[data-fieldname=\"${table}\"] [data-idx] .data-row .sortable-handle`).removeClass('sortable-handle');\r\n\r\n        // Hide add/remove buttons for rows in each child table\r\n        frm.fields_dict[table].grid.wrapper.find('.grid-add-row').hide();\r\n        frm.fields_dict[table].grid.wrapper.find('.grid-remove-rows').hide();\r\n        frm.fields_dict[table].grid.wrapper.find('.grid-remove-all-rows').hide();\r\n        frm.fields_dict[table].grid.wrapper.find('.btn-open-row').hide();\r\n        frm.fields_dict[table].grid.wrapper.find('div.d-flex').css({'visibility':'hidden'});\r\n\r\n        // Hide delete and other buttons within each row\r\n        frm.fields_dict[table].grid.grid_rows.forEach(function(row) {\r\n            row.wrapper.find('.grid-delete-row').hide();\r\n        });\r\n\r\n        // Hide other grid-related buttons\r\n        hide_child_table_buttons(frm, table);\r\n    });\r\n}\r\n\r\n// Function to hide specific buttons in each child table (called during refresh and on_form_rendered)\r\nfunction hide_child_table_buttons(frm, table) {\r\n    frm.fields_dict[table].grid.wrapper.find('.grid-delete-row').hide();\r\n    frm.fields_dict[table].grid.wrapper.find('.grid-insert-row-below').hide();\r\n    frm.fields_dict[table].grid.wrapper.find('.grid-insert-row').hide();\r\n    frm.fields_dict[table].grid.wrapper.find('.grid-duplicate-row').hide();\r\n    frm.fields_dict[table].grid.wrapper.find('.grid-move-row').hide();\r\n    frm.fields_dict[table].grid.wrapper.find('.grid-append-row').hide();\r\n}\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "VA ICT",
  "enabled": 1,
  "modified": "2024-12-27 14:59:04.709981",
  "module": "Digital Economy V2",
  "name": "Cập nhật trường thoi_gian & gắn bản ghi tương ứng (VA ICT)",
  "script": "frappe.ui.form.on('VA ICT', {\r\n    quy: function(frm) {\r\n        update_time(frm);\r\n        find_record(frm);\r\n    },\r\n    nam: function(frm) {\r\n        update_time(frm);\r\n        find_record(frm);\r\n    },\r\n    du_lieu_nam: function(frm) {\r\n        if (frm.doc.du_lieu_nam) {\r\n            frappe.confirm(\r\n                'Nhập dữ liệu cho cả năm?',\r\n                function() {\r\n                    frm.set_value('du_lieu_nam', 1);\r\n                },\r\n                function() {\r\n                    frm.set_value('du_lieu_nam', 0);\r\n                }\r\n            );\r\n        }\r\n        update_time(frm);\r\n        find_record(frm);\r\n    },\r\n});\r\n\r\n// CẬP NHẬT THỜI GIAN\r\nfunction update_time(frm) {\r\n    let quy = frm.doc.quy;\r\n    let nam = frm.doc.nam;\r\n    let du_lieu_nam = frm.doc.du_lieu_nam;\r\n\r\n    if (du_lieu_nam) {\r\n        // Nếu du_lieu_nam được chọn, dùng logic cho cả năm\r\n        let thoi_gian_nam = `${nam}-01-01`;\r\n        if (frm.doc.thoi_gian !== thoi_gian_nam) {\r\n            frm.set_value(\"thoi_gian\", thoi_gian_nam);\r\n        }\r\n    } else {\r\n        // Nếu du_lieu_nam không được chọn, dùng logic dựa trên quý\r\n        if (quy && nam) {\r\n            let thang;\r\n            switch (quy) {\r\n                case \"Q1\":\r\n                    thang = \"01\";\r\n                    break;\r\n                case \"Q2\":\r\n                    thang = \"04\";\r\n                    break;\r\n                case \"Q3\":\r\n                    thang = \"07\";\r\n                    break;\r\n                case \"Q4\":\r\n                    thang = \"10\";\r\n                    break;\r\n                default:\r\n                    thang = \"01\";\r\n            }\r\n            let thoi_gian_moi = `${nam}-${thang}-01`;\r\n\r\n            if (frm.doc.thoi_gian !== thoi_gian_moi) {\r\n                frm.set_value(\"thoi_gian\", thoi_gian_moi);\r\n            }\r\n        } else {\r\n            frm.set_value(\"thoi_gian\", null);\r\n        }\r\n    }\r\n}\r\n\r\n// TÌM BẢN GHI\r\nfunction find_record(frm) {\r\n    let quy = frm.doc.quy;\r\n    let nam = frm.doc.nam;\r\n    let du_lieu_nam = frm.doc.du_lieu_nam;\r\n    let nam_truoc = nam ? nam - 1 : null;\r\n\r\n    // Nếu du_lieu_nam được chọn, chỉ cần tìm kiếm bản ghi dựa trên năm trước\r\n    if (du_lieu_nam) {\r\n        frappe.call({\r\n            method: \"frappe.client.get_list\",\r\n            args: {\r\n                doctype: \"Estimated GRDP\",\r\n                filters: {\r\n                    nam: nam_truoc,\r\n                    du_lieu_nam: 1  // Tìm bản ghi có du_lieu_nam được chọn\r\n                },\r\n                fields: [\"name\"]\r\n            },\r\n            callback: function(r) {\r\n                if (r.message && r.message.length > 0) {\r\n                    var estimatedGrdp = r.message[0];\r\n                    frm.set_value(\"chi_so_grdp_uoc_tinh\", estimatedGrdp.name);\r\n                    frappe.call({\r\n                        method: \"frappe.client.get\",\r\n                        args: {\r\n                            doctype: \"Estimated GRDP\",\r\n                            name: estimatedGrdp.name\r\n                        },\r\n                        callback: function(r) {\r\n                            if (r.message) {\r\n                                frm.clear_table(\"bang_va_ict\");\r\n                                $.each(r.message.bang_uoc_tinh || [], function(index, row) {\r\n                                    var d = frm.add_child(\"bang_va_ict\");\r\n                                    d.nganh_kinh_te = row.nganh_kinh_te;\r\n                                    d.grdp_uoc_tinh = row.grdp_uoc_tinh;\r\n                                    frm.refresh_field(\"bang_va_ict\");\r\n                                });\r\n                            }\r\n                        }\r\n                    });\r\n                } else {\r\n                    frm.set_value(\"chi_so_grdp_uoc_tinh\", \"\");\r\n                    frm.clear_table(\"bang_va_ict\");\r\n                    frm.refresh_field(\"bang_va_ict\");\r\n                }\r\n            }\r\n        });\r\n    } \r\n    // Nếu du_lieu_nam không được chọn, tìm kiếm bản ghi dựa trên quý và năm trước\r\n    else if (quy && nam) {\r\n        frappe.call({\r\n            method: \"frappe.client.get_list\",\r\n            args: {\r\n                doctype: \"Estimated GRDP\",\r\n                filters: {\r\n                    quy: quy,\r\n                    nam: nam_truoc\r\n                },\r\n                fields: [\"name\"]\r\n            },\r\n            callback: function(r) {\r\n                if (r.message && r.message.length > 0) {\r\n                    var estimatedGrdp = r.message[0];\r\n                    frm.set_value(\"chi_so_grdp_uoc_tinh\", estimatedGrdp.name);\r\n                    frappe.call({\r\n                        method: \"frappe.client.get\",\r\n                        args: {\r\n                            doctype: \"Estimated GRDP\",\r\n                            name: estimatedGrdp.name\r\n                        },\r\n                        callback: function(r) {\r\n                            if (r.message) {\r\n                                frm.clear_table(\"bang_va_ict\");\r\n                                $.each(r.message.bang_uoc_tinh || [], function(index, row) {\r\n                                    var d = frm.add_child(\"bang_va_ict\");\r\n                                    d.nganh_kinh_te = row.nganh_kinh_te;\r\n                                    d.grdp_uoc_tinh = row.grdp_uoc_tinh;\r\n                                    frm.refresh_field(\"bang_va_ict\");\r\n                                });\r\n                            }\r\n                        }\r\n                    });\r\n                } else {\r\n                    frm.set_value(\"chi_so_grdp_uoc_tinh\", \"\");\r\n                    frm.clear_table(\"bang_va_ict\");\r\n                    frm.refresh_field(\"bang_va_ict\");\r\n                }\r\n            }\r\n        });\r\n    }\r\n}",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "VA ICT",
  "enabled": 1,
  "modified": "2024-12-27 14:59:04.608324",
  "module": "Digital Economy V2",
  "name": "Tính toán Tổng VA",
  "script": "frappe.ui.form.on('VA ICT', {\r\n    he_so_chuyen_doi: function(frm) {\r\n        if (frm.is_dirty()) {\r\n            // Kiểm tra nếu form có thay đổi, sau đó mới tính toán lại\r\n            (frm.doc.bang_va_ict || []).forEach(function(row) {\r\n                calculate_va_ict(frm, row.doctype, row.name);\r\n            });\r\n        }\r\n    }\r\n});\r\n\r\nfrappe.ui.form.on('VA ICT Industry', {\r\n    ty_le_chi_tieu_ict_tieu_dung_trung_gian: function(frm, cdt, cdn) {\r\n        calculate_va_ict(frm, cdt, cdn);\r\n    }\r\n});\r\n\r\nfunction calculate_va_ict(frm, cdt, cdn) {\r\n    let row = locals[cdt][cdn];\r\n    \r\n    // Update condition to handle 0 value for he_so_chuyen_doi\r\n    if (row.ty_le_chi_tieu_ict_tieu_dung_trung_gian && row.grdp_uoc_tinh && frm.doc.he_so_chuyen_doi !== undefined) {\r\n        let va_ict = row.grdp_uoc_tinh * row.ty_le_chi_tieu_ict_tieu_dung_trung_gian * frm.doc.he_so_chuyen_doi;\r\n        frappe.model.set_value(cdt, cdn, \"va_ict\", va_ict).then(() => {\r\n            calculate_total_va_ict(frm);\r\n        });\r\n    } else {\r\n        frappe.model.set_value(cdt, cdn, \"va_ict\", 0).then(() => {\r\n            calculate_total_va_ict(frm);\r\n        });\r\n    }\r\n}\r\n\r\nfunction calculate_total_va_ict(frm) {\r\n    let tong_va_ict = (frm.doc.bang_va_ict || []).reduce((total, row) => {\r\n        return total + (row.va_ict || 0);\r\n    }, 0);\r\n    \r\n    if (frm.doc.tong_va !== tong_va_ict) {\r\n        frm.set_value(\"tong_va\", tong_va_ict);\r\n    }\r\n}\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "GRDP Index",
  "enabled": 1,
  "modified": "2024-12-27 14:59:04.784036",
  "module": "Digital Economy V2",
  "name": "Tính toán Kết quả KTS",
  "script": "frappe.ui.form.on('GRDP Index', {\r\n    quy: function(frm) {\r\n        fetch_and_update_tables(frm);\r\n    },\r\n    nam: function(frm) {\r\n        fetch_and_update_tables(frm);\r\n    },\r\n    du_lieu_nam: function(frm) {\r\n        fetch_and_update_tables(frm);\r\n    }\r\n});\r\n\r\n// Hàm tìm kiếm bản ghi và cập nhật bảng con\r\nfunction fetch_and_update_tables(frm) {\r\n    // Nếu trường du_lieu_nam được chọn, chỉ tìm theo trường nam\r\n    if (frm.doc.du_lieu_nam) {\r\n        fetch_grdp_table(frm, null, frm.doc.nam, frm.doc.du_lieu_nam);\r\n        fetch_va_ict_table(frm, null, frm.doc.nam, frm.doc.du_lieu_nam);\r\n    }\r\n    // Nếu trường du_lieu_nam không được chọn, tìm theo cả quy và nam\r\n    else {\r\n        fetch_grdp_table(frm, frm.doc.quy, frm.doc.nam, frm.doc.du_lieu_nam);\r\n        fetch_va_ict_table(frm, frm.doc.quy, frm.doc.nam, frm.doc.du_lieu_nam);\r\n    }\r\n}\r\n\r\n// Hàm tìm kiếm bảng dữ liệu Ước tính GRDP\r\nfunction fetch_grdp_table(frm, quy, nam, du_lieu_nam) {\r\n    let filters = { nam: nam, du_lieu_nam: du_lieu_nam }; // Thêm điều kiện du_lieu_nam\r\n    if (quy) {\r\n        filters.quy = quy; // Chỉ thêm điều kiện quy khi không có du_lieu_nam\r\n    }\r\n    frappe.call({\r\n        method: \"frappe.client.get_list\",\r\n        args: {\r\n            doctype: \"Estimated GRDP\",\r\n            filters: filters,\r\n            fields: [\"name\"]\r\n        },\r\n        callback: function(r) {\r\n            if (r.message && r.message.length > 0) {\r\n                let estimatedGrdp = r.message[0];\r\n                frm.set_value(\"du_lieu_uoc_tinh\", estimatedGrdp.name);\r\n                frappe.call({\r\n                    method: \"frappe.client.get\",\r\n                    args: { doctype: \"Estimated GRDP\", name: estimatedGrdp.name },\r\n                    callback: function(r) {\r\n                        frm.clear_table(\"grdp_bang_uoc_tinh\");\r\n                        $.each(r.message.bang_uoc_tinh || [], function(_, row) {\r\n                            let d = frm.add_child(\"grdp_bang_uoc_tinh\");\r\n                            Object.assign(d, row);\r\n                        });\r\n                        frm.refresh_field(\"grdp_bang_uoc_tinh\");\r\n                        setTimeout(function() {\r\n                            calculate_all(frm); \r\n                        }, 100);\r\n                    }\r\n                });\r\n            } else {\r\n                frm.set_value(\"du_lieu_uoc_tinh\", null); // Nếu không tìm thấy dữ liệu trả về null\r\n                frm.clear_table(\"grdp_bang_uoc_tinh\");\r\n                frm.refresh_field(\"grdp_bang_uoc_tinh\");\r\n                setTimeout(function() {\r\n                    calculate_all(frm); \r\n                }, 100);\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\n// Hàm tìm kiếm bảng dữ liệu VA ICT\r\nfunction fetch_va_ict_table(frm, quy, nam, du_lieu_nam) {\r\n    let filters = { nam: nam, du_lieu_nam: du_lieu_nam };\r\n    if (quy) {\r\n        filters.quy = quy;\r\n    }\r\n    frappe.call({\r\n        method: \"frappe.client.get_list\",\r\n        args: {\r\n            doctype: \"VA ICT\",\r\n            filters: filters,\r\n            fields: [\"name\"]\r\n        },\r\n        callback: function(r) {\r\n            if (r.message && r.message.length > 0) {\r\n                let vaIct = r.message[0];\r\n                frm.set_value(\"du_lieu_va_ict\", vaIct.name);\r\n                frm.set_value(\"tong_va\", vaIct.tong_va);\r\n                frappe.call({\r\n                    method: \"frappe.client.get\",\r\n                    args: { doctype: \"VA ICT\", name: vaIct.name },\r\n                    callback: function(r) {\r\n                        frm.clear_table(\"va_bang_va_ict\");\r\n                        $.each(r.message.bang_va_ict || [], function(_, row) {\r\n                            let d = frm.add_child(\"va_bang_va_ict\");\r\n                            Object.assign(d, row);\r\n                        });\r\n                        frm.refresh_field(\"va_bang_va_ict\");\r\n                        setTimeout(function() {\r\n                            calculate_all(frm); \r\n                        }, 100);\r\n                    }\r\n                });\r\n            } else {\r\n                frm.set_value(\"du_lieu_va_ict\", null); // Trả về null nếu không có dữ liệu\r\n                frm.set_value(\"tong_va\", null);\r\n                frm.clear_table(\"va_bang_va_ict\");\r\n                frm.refresh_field(\"va_bang_va_ict\");\r\n                setTimeout(function() {\r\n                    calculate_all(frm); \r\n                }, 100);\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\n// Hàm tính toán KTS và tỷ trọng\r\nfunction calculate_all(frm) {\r\n    calculate_kts_loi(frm); // 1. Chạy hàm tính KTS lõi\r\n    calculate_kts_lan_toa(frm); // 2. Chạy hàm tín KTS lan toả\r\n    calculate_ty_trong_kts_logistics(frm); // 3. Tính tỷ trọng KTS Logistics\r\n    // Kiểm tra đủ dữ liệu trước khi tính KTS tổng\r\n    if (frm.doc.kts_loi != null && frm.doc.kts_lan_toa != null && frm.doc.kts_lan_toa !== 0) {\r\n        calculate_kts_tong(frm); // 4. Chạy hàm tính KTS tổng khi đủ dữ liệu KTS lõi và KTS lan toả\r\n    } else {\r\n        frm.set_value('kts_tong', null); // Nếu không đủ dữ liệu, đặt KTS tổng về null\r\n    }\r\n    calculate_ty_trong_kts_loi(frm); // 5. Chạy hàm tính Tỷ trọng KTS lõi\r\n    calculate_ty_trong_kts_lan_toa(frm); // 6. Chạy hàm tính Tỷ trọng KTS lan toả\r\n    // Kiểm tra đủ dữ liệu trước khi tính tỷ trọng KTS tổng\r\n    if (frm.doc.ty_trong_kts_loi != null && frm.doc.ty_trong_kts_lan_toa != null && frm.doc.ty_trong_kts_lan_toa !== 0) {\r\n        calculate_ty_trong_kts_tong(frm); // 7. Chạy hàm tính Tỷ trọng KTS tổng khi đủ dữ liệu Tỷ trọng KTS lõi và Tỷ trọng KTS lan toả\r\n    } else {\r\n        frm.set_value('ty_trong_kts_tong', null); // Nếu không đủ dữ liệu, đặt Tỷ trọng KTS tổng về null\r\n    }\r\n}\r\n\r\n// 1. Hàm tính toán KTS lõi\r\nfunction calculate_kts_loi(frm) {\r\n    let total_kts_loi = frm.doc.grdp_bang_uoc_tinh.reduce((sum, row) => {\r\n        return row.loai_kts === \"KTS lõi\" ? sum + (row.grdp_uoc_tinh || 0) : sum;\r\n    }, 0);\r\n    if (total_kts_loi != null && total_kts_loi !== 0) {\r\n        frm.set_value('kts_loi', total_kts_loi);\r\n    } else {\r\n        frm.set_value('kts_loi', null);\r\n    }\r\n}\r\n\r\n// 2. Hàm tính toán KTS lan tỏa\r\nfunction calculate_kts_lan_toa(frm) {\r\n    let total_kts_lan_toa = frm.doc.va_bang_va_ict.reduce((sum, row) => {\r\n        return row.loai_kts === \"KTS lõi\" ? sum + (row.va_ict || 0) : sum;\r\n    }, 0);\r\n    let tong_va = frm.doc.tong_va || 0;\r\n    let kts_lan_toa = tong_va - total_kts_lan_toa;\r\n    if (kts_lan_toa != null && kts_lan_toa !== 0) {\r\n        frm.set_value('kts_lan_toa', kts_lan_toa);\r\n    } else {\r\n        frm.set_value('kts_lan_toa', null);\r\n    }\r\n}\r\n\r\n// 3. Hàm tính toán KTS tổng\r\nfunction calculate_kts_tong(frm) {\r\n    if (frm.doc.kts_loi != null && frm.doc.kts_lan_toa != null && frm.doc.kts_lan_toa !== 0) {\r\n        let kts_tong = (frm.doc.kts_loi || 0) + (frm.doc.kts_lan_toa || 0);\r\n        frm.set_value('kts_tong', kts_tong);\r\n    } else {\r\n        frm.set_value('kts_tong', null);\r\n    }\r\n}\r\n\r\n// 4. Hàm tính toán Tỷ trọng KTS lõi\r\nfunction calculate_ty_trong_kts_loi(frm) {\r\n    if (frm.doc.kts_loi != null && frm.doc.kts_loi !== 0) {\r\n        let ty_trong_kts_loi = ((frm.doc.kts_loi || 0) / (frm.doc.tong_grdp_uoc_tinh || 1)) * 100;\r\n        frm.set_value('ty_trong_kts_loi', ty_trong_kts_loi);\r\n    } else {\r\n        frm.set_value('ty_trong_kts_loi', null);\r\n    }\r\n}\r\n\r\n// 5. Hàm tính toán Tỷ trọng KTS lan tỏa\r\nfunction calculate_ty_trong_kts_lan_toa(frm) {\r\n    if (frm.doc.kts_lan_toa != null && frm.doc.kts_lan_toa !== 0) {\r\n        let ty_trong_kts_lan_toa = ((frm.doc.kts_lan_toa || 0) / (frm.doc.tong_grdp_uoc_tinh || 1)) * 100;\r\n        frm.set_value('ty_trong_kts_lan_toa', ty_trong_kts_lan_toa);\r\n    } else {\r\n        frm.set_value('ty_trong_kts_lan_toa', null);\r\n    }\r\n}\r\n\r\n// 6. Hàm tính toán Tỷ trọng KTS tổng\r\nfunction calculate_ty_trong_kts_tong(frm) {\r\n    if (frm.doc.ty_trong_kts_loi != null && frm.doc.ty_trong_kts_lan_toa != null && frm.doc.ty_trong_kts_lan_toa !== 0) {\r\n        let ty_trong_kts_tong = (frm.doc.ty_trong_kts_loi || 0) + (frm.doc.ty_trong_kts_lan_toa || 0);\r\n        frm.set_value('ty_trong_kts_tong', ty_trong_kts_tong);\r\n    } else {\r\n        frm.set_value('ty_trong_kts_tong', null);\r\n    }\r\n}\r\n\r\n// 7. Hàm tính toán Tỷ trọng KTS Logistics\r\nfunction calculate_ty_trong_kts_logistics(frm) {\r\n    let grdp_van_tai_kho_bai = frm.doc.grdp_bang_uoc_tinh.find(row => row.nganh_kinh_te === \"H. Vận tải kho bãi\");\r\n    let va_ict_van_tai_kho_bai = frm.doc.va_bang_va_ict.find(row => row.nganh_kinh_te === \"H. Vận tải kho bãi\");\r\n\r\n    if (grdp_van_tai_kho_bai && va_ict_van_tai_kho_bai && grdp_van_tai_kho_bai.grdp_uoc_tinh > 0) {\r\n        let ty_trong_kts_logistics = (va_ict_van_tai_kho_bai.va_ict / grdp_van_tai_kho_bai.grdp_uoc_tinh) * 100;\r\n        frm.set_value('ty_trong_kts_logistics', ty_trong_kts_logistics);\r\n    } else {\r\n        frm.set_value('ty_trong_kts_logistics', null);\r\n    }\r\n}\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "GRDP Index",
  "enabled": 1,
  "modified": "2024-12-27 14:59:04.734685",
  "module": "Digital Economy V2",
  "name": "Cập nhật trường thoi_gian (GRDP Index)",
  "script": "frappe.ui.form.on('GRDP Index', {\r\n    quy: function(frm) {\r\n        update_time(frm);\r\n    },\r\n    nam: function(frm) {\r\n        update_time(frm);\r\n    },\r\n    du_lieu_nam: function(frm) {\r\n        if (frm.doc.du_lieu_nam) {\r\n            frappe.confirm(\r\n                'Nhập dữ liệu cho cả năm?',\r\n                function() {\r\n                    frm.set_value('du_lieu_nam', 1);\r\n                },\r\n                function() {\r\n                    frm.set_value('du_lieu_nam', 0);\r\n                }\r\n            );\r\n        }\r\n        update_time(frm);\r\n    },\r\n});\r\n\r\nfunction update_time(frm) {\r\n    // Nếu trường du_lieu_nam được chọn\r\n    if (frm.doc.du_lieu_nam) {\r\n        let thoi_gian_moi = `${frm.doc.nam}-01-01`;\r\n        if (frm.doc.thoi_gian !== thoi_gian_moi) {\r\n            frm.set_value(\"thoi_gian\", thoi_gian_moi);\r\n        }\r\n    }\r\n    // Nếu trường du_lieu_nam không được chọn\r\n    else {\r\n        let thang_map = { \"Q1\": \"01\", \"Q2\": \"04\", \"Q3\": \"07\", \"Q4\": \"10\" };\r\n        let thang = thang_map[frm.doc.quy] || \"01\";\r\n        let thoi_gian_moi = `${frm.doc.nam}-${thang}-01`;\r\n        \r\n        if (frm.doc.thoi_gian !== thoi_gian_moi) {\r\n            frm.set_value(\"thoi_gian\", thoi_gian_moi);\r\n        }\r\n    }\r\n}\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "VA ICT",
  "enabled": 1,
  "modified": "2024-12-27 14:59:04.660176",
  "module": "Digital Economy V2",
  "name": "Ẩn nút thêm/xoá/điều chỉnh vị trí hàng của bảng con",
  "script": "frappe.ui.form.on('VA ICT', {\n\trefresh: function(frm) {\n        if (frappe.session.user !== \"Administrator\") {\n            // Khoá tính năng thay đổi vị trí hàng\n            disable_drag_drop(frm);\n            // Khoá khả năng thêm và xóa dòng trong bảng con bang_va_ict\n            cur_frm.fields_dict.bang_va_ict.grid.wrapper.find('.grid-add-row').hide();\n            cur_frm.fields_dict.bang_va_ict.grid.wrapper.find('.grid-remove-rows').hide();\n            cur_frm.fields_dict.bang_va_ict.grid.wrapper.find('.grid-remove-all-rows').hide();\n            cur_frm.fields_dict.bang_va_ict.$wrapper.find('.grid-body .rows').find(\".grid-row\").each(function(i, item) {\n                // Lấy dữ liệu của dòng hiện tại\n                let d = locals[cur_frm.fields_dict.bang_va_ict.grid.doctype][$(item).attr('data-name')];\n                // Kiểm tra nếu loai_kts là \"KTS lõi\"\n                if (d.loai_kts === \"KTS lõi\") {\n                    // Bôi đậm các ngành ICT\n                    $(item).find('.grid-static-col[data-fieldname]').css({\n                        'font-weight': 'bold'\n                    });\n                }\n            });\n            // Ẩn cột Edit cột và hàng với tài khoản Users\n            cur_frm.fields_dict.bang_va_ict.grid.wrapper.find('div.d-flex').css({'visibility':'hidden'});\n            cur_frm.fields_dict.bang_va_ict.grid.wrapper.find('.btn-open-row').hide();\n            // Disable các nút xóa row trong mỗi dòng\n            $.each(cur_frm.fields_dict.bang_va_ict.grid.grid_rows, function(index, row) {\n                row.wrapper.find('.grid-delete-row').hide();\n            });\n        }\n    },\n    bang_va_ict_on_form_rendered: function(frm, cdt, cdn) {\n        if (frappe.session.user !== \"Administrator\") {\n            cur_frm.fields_dict.bang_va_ict.grid.wrapper.find('.grid-delete-row').hide();\n            cur_frm.fields_dict.bang_va_ict.grid.wrapper.find('.grid-insert-row-below').hide();\n            cur_frm.fields_dict.bang_va_ict.grid.wrapper.find('.grid-insert-row').hide();\n            cur_frm.fields_dict.bang_va_ict.grid.wrapper.find('.grid-duplicate-row').hide();\n            cur_frm.fields_dict.bang_va_ict.grid.wrapper.find('.grid-move-row').hide();\n            cur_frm.fields_dict.bang_va_ict.grid.wrapper.find('.grid-append-row').hide();\n            cur_frm.fields_dict.bang_va_ict.grid.wrapper.find('.grid-add-row').hide();\n        }\n    },\n});\nfunction disable_drag_drop(frm) {\n    frm.page.body.find('[data-fieldname=\"bang_va_ict\"] [data-idx] .data-row .sortable-handle').removeClass('sortable-handle');\n}\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "GRDP Index",
  "enabled": 1,
  "modified": "2024-12-27 14:59:04.831467",
  "module": "Digital Economy V2",
  "name": "Ẩn thêm/xoá/điều chỉnh hàng cho bảng con (GRDP Index)",
  "script": "frappe.ui.form.on('GRDP Index', {\n\trefresh: function(frm) {\n        // Logic xử lý khác cho bảng con\n        frm.fields_dict.grdp_bang_uoc_tinh.$wrapper.find('.grid-body .rows').find(\".grid-row\").each(function(i, item) {\n            let d = locals[frm.fields_dict.grdp_bang_uoc_tinh.grid.doctype][$(item).attr('data-name')];\n            if (d.loai_kts === \"KTS lõi\") {\n                $(item).find('.grid-static-col[data-fieldname]').css({'font-weight': 'bold'});\n            }\n        });\n\n        frm.fields_dict.va_bang_va_ict.$wrapper.find('.grid-body .rows').find(\".grid-row\").each(function(i, item) {\n            let d = locals[frm.fields_dict.va_bang_va_ict.grid.doctype][$(item).attr('data-name')];\n            if (d.loai_kts === \"KTS lõi\") {\n                $(item).find('.grid-static-col[data-fieldname]').css({'font-weight': 'bold'});\n            }\n        });\n\n        if (frappe.session.user !== \"Administrator\") {\n            cur_frm.fields_dict.grdp_bang_uoc_tinh.grid.wrapper.find('div.d-flex').css({'visibility':'hidden'});\n            cur_frm.fields_dict.grdp_bang_uoc_tinh.grid.wrapper.find('.btn-open-row').hide();\n            cur_frm.fields_dict.grdp_bang_uoc_tinh.grid.wrapper.find('.grid-move-row').hide();\n            cur_frm.fields_dict.grdp_bang_uoc_tinh.grid.wrapper.find('.grid-append-row').hide();\n            cur_frm.fields_dict.va_bang_va_ict.grid.wrapper.find('div.d-flex').css({'visibility':'hidden'});\n            cur_frm.fields_dict.va_bang_va_ict.grid.wrapper.find('.btn-open-row').hide();\n            cur_frm.fields_dict.va_bang_va_ict.grid.wrapper.find('.grid-move-row').hide();\n            cur_frm.fields_dict.va_bang_va_ict.grid.wrapper.find('.grid-append-row').hide();\n        }\n    },\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Estimated GRDP",
  "enabled": 1,
  "modified": "2024-12-27 14:59:04.759506",
  "module": "Digital Economy V2",
  "name": "Cập nhật trường thoi_gian (Estimated GRDP)",
  "script": "frappe.ui.form.on('Estimated GRDP', {\n\tdu_lieu_nam: function(frm) {\n        if (frm.doc.du_lieu_nam) {\n            frappe.confirm(\n                'Nhập dữ liệu cho cả năm?',\n                function() {\n                    frm.set_value('du_lieu_nam', 1);\n                },\n                function() {\n                    frm.set_value('du_lieu_nam', 0);\n                }\n            );\n        }\n    },\n    quy: function(frm) {\n        update_time(frm);\n    },\n    nam: function(frm) {\n        update_time(frm);\n    },\n});\n\nfunction update_time(frm) {\n    let quy = frm.doc.quy;\n    let nam = frm.doc.nam;\n    let du_lieu_nam = frm.doc.du_lieu_nam;\n\n    if (du_lieu_nam) {\n        // Nếu du_lieu_nam được chọn\n        let thoi_gian_nam = `${nam}-01-01`;\n        if (frm.doc.thoi_gian !== thoi_gian_nam) {\n            frm.set_value(\"thoi_gian\", thoi_gian_nam);\n        }\n    } else {\n        // Nếu du_lieu_nam KHÔNG được chọn\n        if (quy && nam) {\n            let thang;\n            switch (quy) {\n                case \"Q1\":\n                    thang = \"01\";\n                    break;\n                case \"Q2\":\n                    thang = \"04\";\n                    break;\n                case \"Q3\":\n                    thang = \"07\";\n                    break;\n                case \"Q4\":\n                    thang = \"10\";\n                    break;\n                default:\n                    thang = \"01\";\n            }\n            let thoi_gian_moi = `${nam}-${thang}-01`;\n            if (frm.doc.thoi_gian !== thoi_gian_moi) {\n                frm.set_value(\"thoi_gian\", thoi_gian_moi);\n            }\n        } else {\n            frm.set_value(\"thoi_gian\", null);\n        }\n    }\n}",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Estimated GRDP",
  "enabled": 1,
  "modified": "2024-12-27 14:59:04.807861",
  "module": "Digital Economy V2",
  "name": "Tính tổng GRDP ước tính + Thuế",
  "script": "frappe.ui.form.on('Estimated GRDP', {\r\n    onload: function(frm) {\r\n        if (frm.doc.__islocal) {\r\n            frm.clear_table(\"bang_uoc_tinh\");\r\n            var rows_data = [\r\n                \"Phần cứng, thiết bị và linh kiện điện tử, quang học\",\r\n                \"A. Nông nghiệp, lâm nghiệp và thuỷ sản\",\r\n                \"B. Khai khoáng\",\r\n                \"C. Công nghiệp, chế biến, chế tạo\",\r\n                \"D. Sản xuất và phân phối điện, khí đốt, nước nóng, hơi nước và điều hoà không khí\",\r\n                \"E. Cung cấp nước; hoạt động quản lý và xử lý rác thải, nước thải\",\r\n                \"F. Xây dựng\",\r\n                \"G. Bán buôn và bán lẻ; sửa chữa ô tô, mô tô, xe máy và xe có động cơ khác\",\r\n                \"H. Vận tải kho bãi\",\r\n                \"I. Dịch vụ lưu trú và ăn uống\",\r\n                \"J. Thông tin và truyền thông\",\r\n                \"K. Hoạt động tài chính, ngân hàng và bảo hiểm\",\r\n                \"L. Hoạt động kinh doanh bất động sản\",\r\n                \"M. Hoạt động chuyên môn, khoa học và công nghệ\",\r\n                \"N. Hoạt động hành chính và dịch vụ hỗ trợ\",\r\n                \"O. HĐ của Đảng cộng sản, tổ chức chính trị - xã hội, quản lý nhà nước, an ninh quốc phòng; bảo đảm xã hội bắt buộc\",\r\n                \"P. Giáo dục và đào tạo\",\r\n                \"Q. Y tế và hoạt động trợ giúp xã hội\",\r\n                \"R. Nghệ thuật, vui chơi và giải trí\",\r\n                \"S. Hoạt động dịch vụ khác\",\r\n                \"T. HĐ làm thuê các công việc trong các hộ gia đình, sản xuất sản phẩm vật chất và dịch vụ tự tiêu dùng của hộ gia đình\"\r\n            ];\r\n            \r\n            rows_data.forEach(function(row_data) {\r\n                var new_row = frm.add_child(\"bang_uoc_tinh\");\r\n                new_row.nganh_kinh_te = row_data;\r\n            });\r\n            frm.refresh_field(\"bang_uoc_tinh\");\r\n        }\r\n    },\r\n    thue_san_pham_tru_tro_cap_san_pham: function(frm) {\r\n        calculate_total_grdp(frm);\r\n    }\r\n});\r\n\r\nfrappe.ui.form.on('Estimated Industry GRDP', {\r\n    grdp_uoc_tinh: function(frm, cdt, cdn) {\r\n        calculate_total_grdp(frm);\r\n    }\r\n});\r\n\r\nfunction calculate_total_grdp(frm) {\r\n    var total = 0;\r\n    // Kiểm tra xem dữ liệu có tồn tại không\r\n    if (!frm.doc.bang_uoc_tinh) {\r\n        return; // Thoát nếu không có dữ liệu\r\n    }\r\n    $.each(frm.doc.bang_uoc_tinh, function(i, row) {\r\n        if (row.grdp_uoc_tinh) {\r\n            total += row.grdp_uoc_tinh; \r\n        }\r\n    });\r\n    // Cộng thêm giá trị từ trường thue_san_pham_tru_tro_cap_san_pham\r\n    if (frm.doc.thue_san_pham_tru_tro_cap_san_pham) {\r\n        total += frm.doc.thue_san_pham_tru_tro_cap_san_pham;\r\n    }\r\n    frm.set_value('tong_grdp_uoc_tinh', total);\r\n    frm.refresh_field('tong_grdp_uoc_tinh');\r\n}\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Estimated GRDP",
  "enabled": 1,
  "modified": "2024-12-27 14:59:04.684362",
  "module": "Digital Economy V2",
  "name": "Ẩn các nút thêm/xoá/điều chỉnh hàng ở bảng con",
  "script": "frappe.ui.form.on('Estimated GRDP', {\r\n    refresh: function(frm) {\r\n        if (frappe.session.user !== \"Administrator\") {\r\n            // Khoá tính năng thay đổi vị trí hàng\r\n            disable_drag_drop(frm);\r\n            // Khoá khả năng thêm và xóa dòng trong bảng con bang_uoc_tinh\r\n            cur_frm.fields_dict.bang_uoc_tinh.grid.wrapper.find('.grid-add-row').hide();\r\n            cur_frm.fields_dict.bang_uoc_tinh.grid.wrapper.find('.grid-remove-rows').hide();\r\n            cur_frm.fields_dict.bang_uoc_tinh.grid.wrapper.find('.grid-remove-all-rows').hide();\r\n            cur_frm.fields_dict.bang_uoc_tinh.$wrapper.find('.grid-body .rows').find(\".grid-row\").each(function(i, item) {\r\n                // Lấy dữ liệu của dòng hiện tại\r\n                let d = locals[cur_frm.fields_dict.bang_uoc_tinh.grid.doctype][$(item).attr('data-name')];\r\n                // Kiểm tra nếu loai_kts là \"KTS lõi\"\r\n                if (d.loai_kts === \"KTS lõi\") {\r\n                    // Bôi đậm các ngành ICT\r\n                    $(item).find('.grid-static-col[data-fieldname]').css({\r\n                        'font-weight': 'bold'\r\n                    });\r\n                }\r\n            });\r\n            // Ẩn cột Edit cột và hàng với tài khoản Users\r\n            cur_frm.fields_dict.bang_uoc_tinh.grid.wrapper.find('div.d-flex').css({'visibility':'hidden'});\r\n            cur_frm.fields_dict.bang_uoc_tinh.grid.wrapper.find('.btn-open-row').hide();\r\n            // Disable các nút xóa row trong mỗi dòng\r\n            $.each(cur_frm.fields_dict.bang_uoc_tinh.grid.grid_rows, function(index, row) {\r\n                row.wrapper.find('.grid-delete-row').hide(); // Ẩn nút delete khi ở ngoài\r\n            });\r\n        }\r\n    },\r\n    bang_uoc_tinh_on_form_rendered: function(frm, cdt, cdn) {\r\n        if (frappe.session.user !== \"Administrator\") {\r\n            cur_frm.fields_dict.bang_uoc_tinh.grid.wrapper.find('.grid-delete-row').hide();\r\n            cur_frm.fields_dict.bang_uoc_tinh.grid.wrapper.find('.grid-insert-row-below').hide();\r\n            cur_frm.fields_dict.bang_uoc_tinh.grid.wrapper.find('.grid-insert-row').hide();\r\n            cur_frm.fields_dict.bang_uoc_tinh.grid.wrapper.find('.grid-duplicate-row').hide();\r\n            cur_frm.fields_dict.bang_uoc_tinh.grid.wrapper.find('.grid-move-row').hide();\r\n            cur_frm.fields_dict.bang_uoc_tinh.grid.wrapper.find('.grid-append-row').hide();\r\n        }\r\n    },\r\n});\r\nfunction disable_drag_drop(frm) {\r\n    frm.page.body.find('[data-fieldname=\"bang_uoc_tinh\"] [data-idx] .data-row .sortable-handle').removeClass('sortable-handle');\r\n}\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Input Variable",
  "enabled": 1,
  "modified": "2024-12-27 14:59:04.636467",
  "module": "Digital Economy V2",
  "name": "Tự động thêm ngành khi tạo bản ghi Input Variable",
  "script": "frappe.ui.form.on('Input Variable', {\n    onload: function(frm) {\n        if (frm.doc.__islocal) {\n            frm.clear_table(\"input_template_table\");\n            var rows_data = [\n                \"Phần cứng, thiết bị và linh kiện điện tử, quang học\",\n                \"A. Nông nghiệp, lâm nghiệp và thuỷ sản\",\n                \"B. Khai khoáng\",\n                \"C. Công nghiệp, chế biến, chế tạo\",\n                \"D. Sản xuất và phân phối điện, khí đốt, nước nóng, hơi nước và điều hoà không khí\",\n                \"E. Cung cấp nước; hoạt động quản lý và xử lý rác thải, nước thải\",\n                \"F. Xây dựng\",\n                \"G. Bán buôn và bán lẻ; sửa chữa ô tô, mô tô, xe máy và xe có động cơ khác\",\n                \"H. Vận tải kho bãi\",\n                \"I. Dịch vụ lưu trú và ăn uống\",\n                \"J. Thông tin và truyền thông\",\n                \"K. Hoạt động tài chính, ngân hàng và bảo hiểm\",\n                \"L. Hoạt động kinh doanh bất động sản\",\n                \"M. Hoạt động chuyên môn, khoa học và công nghệ\",\n                \"N. Hoạt động hành chính và dịch vụ hỗ trợ\",\n                \"O. HĐ của Đảng cộng sản, tổ chức chính trị - xã hội, quản lý nhà nước, an ninh quốc phòng; bảo đảm xã hội bắt buộc\",\n                \"P. Giáo dục và đào tạo\",\n                \"Q. Y tế và hoạt động trợ giúp xã hội\",\n                \"R. Nghệ thuật, vui chơi và giải trí\",\n                \"S. Hoạt động dịch vụ khác\",\n                \"T. HĐ làm thuê các công việc trong các hộ gia đình, sản xuất sản phẩm vật chất và dịch vụ tự tiêu dùng của hộ gia đình\"\n            ];\n            \n            rows_data.forEach(function(row_data) {\n                var new_row = frm.add_child(\"input_template_table\");\n                new_row.nganh_kinh_te = row_data;\n            });\n            frm.refresh_field(\"input_template_table\");\n        }\n    },\n    refresh: function(frm) {\n        disable_drag_drop(frm);\n        cur_frm.fields_dict.input_template_table.$wrapper.find('.grid-body .rows').find(\".grid-row\").each(function(i, item) {\n            // Lấy dữ liệu của dòng hiện tại\n            let d = locals[cur_frm.fields_dict.input_template_table.grid.doctype][$(item).attr('data-name')];\n            // Kiểm tra nếu loai_kts là \"KTS lõi\"\n            if (d.loai_kts === \"KTS lõi\") {\n                // Bôi đậm các ngành ICT\n                $(item).find('.grid-static-col[data-fieldname]').css({\n                    'font-weight': 'bold'\n                });\n            }\n        });\n    },\n})\n\nfunction disable_drag_drop(frm) {\n    frm.page.body.find('[data-fieldname=\"input_template_table\"] [data-idx] .data-row .sortable-handle').removeClass('sortable-handle');\n}",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "VA ICT",
  "enabled": 1,
  "modified": "2024-12-27 14:59:04.580359",
  "module": "Digital Economy V2",
  "name": "Cập nhật Tỷ lệ chi tiêu ICT/Tiêu dùng trung gian",
  "script": "frappe.ui.form.on('VA ICT', {\n    bien_dau_vao: function(frm) {\n        if (frm.doc.bien_dau_vao) {\n            frappe.call({\n                method: 'frappe.client.get',\n                args: {\n                    doctype: \"Input Variable\",\n                    filters: {\n                        name: frm.doc.bien_dau_vao\n                    }\n                },\n                callback: function(r) {\n                    if (r.message) {\n                        frm.set_value('he_so_chuyen_doi', r.message.he_so_chuyen_doi);\n                        let input_template_table = r.message.input_template_table || [];\n                        // Iterate over the bang_va_ict table in VA ICT and match nganh_kinh_te\n                        frm.doc.bang_va_ict.forEach(row => {\n                            let matching_input = input_template_table.find(input_row => input_row.nganh_kinh_te === row.nganh_kinh_te);\n                            if (matching_input) {\n                                // Set the ty_le_chi_tieu_ict_tieu_dung_trung_gian from input_template_table to bang_va_ict\n                                frappe.model.set_value(row.doctype, row.name, 'ty_le_chi_tieu_ict_tieu_dung_trung_gian', matching_input.ty_le_chi_tieu_ict_tieu_dung_trung_gian);\n                            }\n                        });\n                        // Refresh the child table to reflect the changes\n                        frm.refresh_field('bang_va_ict');\n                    }\n                }\n            })\n\t\t}\n\t}\n})",
  "view": "Form"
 }
]